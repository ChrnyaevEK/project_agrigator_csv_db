<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Timescaled DB: src/core.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Timescaled DB
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">core.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;kore/kore.h&gt;</code><br />
<code>#include &lt;kore/http.h&gt;</code><br />
<code>#include &lt;kore/pgsql.h&gt;</code><br />
<code>#include &lt;libintl.h&gt;</code><br />
<code>#include &lt;locale.h&gt;</code><br />
<code>#include &quot;<a class="el" href="agrlib__v2_8h_source.html">agrlib_v2.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for core.c:</div>
<div class="dyncontent">
<div class="center"><img src="core_8c__incl.png" border="0" usemap="#src_2core_8c" alt=""/></div>
<map name="src_2core_8c" id="src_2core_8c">
<area shape="rect" id="node7" href="agrlib__v2_8h.html" title="agrlib_v2.h" alt="" coords="521,80,606,107"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab92bb4161a6308b302d283816975c3a6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#ab92bb4161a6308b302d283816975c3a6">_</a>(STRING)&#160;&#160;&#160;gettext(STRING)</td></tr>
<tr class="separator:ab92bb4161a6308b302d283816975c3a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ab5b9aaf3850b085ca39abf901b2751"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a5ab5b9aaf3850b085ca39abf901b2751">TEST_CASE</a></td></tr>
<tr class="memdesc:a5ab5b9aaf3850b085ca39abf901b2751"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define TEST_CASE to perfom output to stdout when debuging or testing.  <a href="#a5ab5b9aaf3850b085ca39abf901b2751">More...</a><br /></td></tr>
<tr class="separator:a5ab5b9aaf3850b085ca39abf901b2751"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22e00999d254cceeb29d2a858b432e41"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a22e00999d254cceeb29d2a858b432e41">_</a>(A)&#160;&#160;&#160;gettext(A)</td></tr>
<tr class="separator:a22e00999d254cceeb29d2a858b432e41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8db4f72cfa2b36aba553c8fd1ab6af9e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a8db4f72cfa2b36aba553c8fd1ab6af9e">LOCALE_DIR</a>&#160;&#160;&#160;&quot;locale&quot;</td></tr>
<tr class="memdesc:a8db4f72cfa2b36aba553c8fd1ab6af9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">For l18n - define here the directory with .mo files.  <a href="#a8db4f72cfa2b36aba553c8fd1ab6af9e">More...</a><br /></td></tr>
<tr class="separator:a8db4f72cfa2b36aba553c8fd1ab6af9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca8570fb706c81df371b7f9bc454ae03"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#aca8570fb706c81df371b7f9bc454ae03">PACKAGE</a>&#160;&#160;&#160;&quot;core&quot;</td></tr>
<tr class="memdesc:aca8570fb706c81df371b7f9bc454ae03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define here the name of file.mo to use.  <a href="#aca8570fb706c81df371b7f9bc454ae03">More...</a><br /></td></tr>
<tr class="separator:aca8570fb706c81df371b7f9bc454ae03"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a63c2c93fc1421e2956860a788fce8617"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a63c2c93fc1421e2956860a788fce8617">init</a> (int state)</td></tr>
<tr class="memdesc:a63c2c93fc1421e2956860a788fce8617"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register database.  <a href="#a63c2c93fc1421e2956860a788fce8617">More...</a><br /></td></tr>
<tr class="separator:a63c2c93fc1421e2956860a788fce8617"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6543687223c9eafbac413e52ddd2da7b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a6543687223c9eafbac413e52ddd2da7b">page</a> (struct http_request *)</td></tr>
<tr class="memdesc:a6543687223c9eafbac413e52ddd2da7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dealing with request.  <a href="#a6543687223c9eafbac413e52ddd2da7b">More...</a><br /></td></tr>
<tr class="separator:a6543687223c9eafbac413e52ddd2da7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0939e2f18610176aada23a5961ce7ecd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a0939e2f18610176aada23a5961ce7ecd">form_response</a> (struct kore_buf *buf, char **table_sorted)</td></tr>
<tr class="memdesc:a0939e2f18610176aada23a5961ce7ecd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forms html response, but does not send it. Table is formed from 'table_sorted'.  <a href="#a0939e2f18610176aada23a5961ce7ecd">More...</a><br /></td></tr>
<tr class="separator:a0939e2f18610176aada23a5961ce7ecd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8192996f3c522f10ab475ec2b6e6f4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#af8192996f3c522f10ab475ec2b6e6f4a">form_and_fire_query</a> (struct kore_buf *qr_buf, struct kore_pgsql *sql, char *line)</td></tr>
<tr class="memdesc:af8192996f3c522f10ab475ec2b6e6f4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Responsible for quering database with INSERT commands.  <a href="#af8192996f3c522f10ab475ec2b6e6f4a">More...</a><br /></td></tr>
<tr class="separator:af8192996f3c522f10ab475ec2b6e6f4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f53c2262b7acaa2b5a1e1d2463f14f1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a9f53c2262b7acaa2b5a1e1d2463f14f1">setup_conn</a> (struct kore_pgsql *sql)</td></tr>
<tr class="memdesc:a9f53c2262b7acaa2b5a1e1d2463f14f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up / opens connection with database.  <a href="#a9f53c2262b7acaa2b5a1e1d2463f14f1">More...</a><br /></td></tr>
<tr class="separator:a9f53c2262b7acaa2b5a1e1d2463f14f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3444f46f7643490834531d552454bcd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#ab3444f46f7643490834531d552454bcd">create_table_if_notexist</a> (char *csv_header, struct kore_pgsql *sql)</td></tr>
<tr class="memdesc:ab3444f46f7643490834531d552454bcd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates table if not exist.  <a href="#ab3444f46f7643490834531d552454bcd">More...</a><br /></td></tr>
<tr class="separator:ab3444f46f7643490834531d552454bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50873f71312e18a4e1eeb8b30c4b755f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a50873f71312e18a4e1eeb8b30c4b755f">database_query</a> (struct kore_pgsql *sql, char **table_sorted)</td></tr>
<tr class="memdesc:a50873f71312e18a4e1eeb8b30c4b755f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up database connection, performs all queries.  <a href="#a50873f71312e18a4e1eeb8b30c4b755f">More...</a><br /></td></tr>
<tr class="separator:a50873f71312e18a4e1eeb8b30c4b755f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a519c8e500ba2ea066c723ee28e30fa04"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a519c8e500ba2ea066c723ee28e30fa04">html_table</a> [] = &quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=\&quot;UTF-8\&quot;&gt;&lt;style&gt;table{font-family: arial, sans-serif;border-collapse: collapse;width: 100%;}td, th {border: 1px solid #dddddd;text-align: left;padding: 8px;}tr:nth-child(even) {background-color: #dddddd;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;RESULTS&lt;/h2&gt;&lt;table&gt;&quot;</td></tr>
<tr class="memdesc:a519c8e500ba2ea066c723ee28e30fa04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tamplate for generated HTML table.  <a href="#a519c8e500ba2ea066c723ee28e30fa04">More...</a><br /></td></tr>
<tr class="separator:a519c8e500ba2ea066c723ee28e30fa04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba77d446d3c6b20fc708dbaa56669a8d"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#aba77d446d3c6b20fc708dbaa56669a8d">error_response_header</a> [] = &quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=\&quot;utf-8\&quot;&gt;&lt;/head&gt;&lt;body&gt;LOG:&quot;</td></tr>
<tr class="memdesc:aba77d446d3c6b20fc708dbaa56669a8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tamplate for generated HTML error response.  <a href="#aba77d446d3c6b20fc708dbaa56669a8d">More...</a><br /></td></tr>
<tr class="separator:aba77d446d3c6b20fc708dbaa56669a8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56c55320a85231784cb14d45e6d8043a"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a56c55320a85231784cb14d45e6d8043a">error_response_end</a> [] = &quot;&lt;/body&gt;&lt;/html&gt;&quot;</td></tr>
<tr class="separator:a56c55320a85231784cb14d45e6d8043a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88018c0aba001bc30dd2bf70c5098c02"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a88018c0aba001bc30dd2bf70c5098c02">html_table_end</a> [] = &quot;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;&quot;</td></tr>
<tr class="memdesc:a88018c0aba001bc30dd2bf70c5098c02"><td class="mdescLeft">&#160;</td><td class="mdescRight">End of table.  <a href="#a88018c0aba001bc30dd2bf70c5098c02">More...</a><br /></td></tr>
<tr class="separator:a88018c0aba001bc30dd2bf70c5098c02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bffe9444fb0c41cb785eef0ceb29a8d"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a1bffe9444fb0c41cb785eef0ceb29a8d">conn_str</a> [] = &quot;host=localhost dbname=your_database_name user=example_user password=example&quot;</td></tr>
<tr class="memdesc:a1bffe9444fb0c41cb785eef0ceb29a8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main connection string, fill with your parametrs according to PGSQL connection string rules.  <a href="#a1bffe9444fb0c41cb785eef0ceb29a8d">More...</a><br /></td></tr>
<tr class="separator:a1bffe9444fb0c41cb785eef0ceb29a8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab013af67ba953d509575c86d9e65da44"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#ab013af67ba953d509575c86d9e65da44">table_name</a></td></tr>
<tr class="memdesc:ab013af67ba953d509575c86d9e65da44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Table name to use if it is not created from file name(CREATE_NAME_FROM_FILE not defined)  <a href="#ab013af67ba953d509575c86d9e65da44">More...</a><br /></td></tr>
<tr class="separator:ab013af67ba953d509575c86d9e65da44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6415df1e2eb068fae92d9ec1dab1702"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#ac6415df1e2eb068fae92d9ec1dab1702">max_entry_size</a> [] = &quot; varchar(40) &quot;</td></tr>
<tr class="memdesc:ac6415df1e2eb068fae92d9ec1dab1702"><td class="mdescLeft">&#160;</td><td class="mdescRight">If table is new created, each entry is treated as text(varchar). Here is max size of each entry.  <a href="#ac6415df1e2eb068fae92d9ec1dab1702">More...</a><br /></td></tr>
<tr class="separator:ac6415df1e2eb068fae92d9ec1dab1702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a706bc0a919ca845fc1f5c8f58074e924"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a706bc0a919ca845fc1f5c8f58074e924">ts_in_db</a> [] = &quot; timestamp &quot;</td></tr>
<tr class="memdesc:a706bc0a919ca845fc1f5c8f58074e924"><td class="mdescLeft">&#160;</td><td class="mdescRight">This key is used for column with timestamp, if database is created.  <a href="#a706bc0a919ca845fc1f5c8f58074e924">More...</a><br /></td></tr>
<tr class="separator:a706bc0a919ca845fc1f5c8f58074e924"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b2ae53d82dc2d82a6ba3d6488e3638f"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a4b2ae53d82dc2d82a6ba3d6488e3638f">path_to_csv</a></td></tr>
<tr class="separator:a4b2ae53d82dc2d82a6ba3d6488e3638f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc370adb7e2af08ae0ab13964d45d1c4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#abc370adb7e2af08ae0ab13964d45d1c4">max_try_conn</a> = 5</td></tr>
<tr class="memdesc:abc370adb7e2af08ae0ab13964d45d1c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Holds the number of attempts to do, when trying to access database.  <a href="#abc370adb7e2af08ae0ab13964d45d1c4">More...</a><br /></td></tr>
<tr class="separator:abc370adb7e2af08ae0ab13964d45d1c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b9a9c1be87e8344b94882f91f56805b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a6b9a9c1be87e8344b94882f91f56805b">escape_needed</a> = 1</td></tr>
<tr class="memdesc:a6b9a9c1be87e8344b94882f91f56805b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This flag wraps query in $$ for escaping some characters(like quots)  <a href="#a6b9a9c1be87e8344b94882f91f56805b">More...</a><br /></td></tr>
<tr class="separator:a6b9a9c1be87e8344b94882f91f56805b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad25499646dfc76b1dfafbe258ea21f19"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#ad25499646dfc76b1dfafbe258ea21f19">form_name_from_path</a> = 1</td></tr>
<tr class="memdesc:ad25499646dfc76b1dfafbe258ea21f19"><td class="mdescLeft">&#160;</td><td class="mdescRight">If no name was suplied to create table with and this flag is up - we will get name from file.  <a href="#ad25499646dfc76b1dfafbe258ea21f19">More...</a><br /></td></tr>
<tr class="separator:ad25499646dfc76b1dfafbe258ea21f19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a299efd1f0f06729d349e9c000260a4a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="core_8c.html#a299efd1f0f06729d349e9c000260a4a1">name_len</a> = 0</td></tr>
<tr class="separator:a299efd1f0f06729d349e9c000260a4a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab92bb4161a6308b302d283816975c3a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab92bb4161a6308b302d283816975c3a6">&#9670;&nbsp;</a></span>_ <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">STRING</td><td>)</td>
          <td>&#160;&#160;&#160;gettext(STRING)</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section author"><dt>Author</dt><dd>Cherniaev Egor </dd></dl>

</div>
</div>
<a id="a22e00999d254cceeb29d2a858b432e41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22e00999d254cceeb29d2a858b432e41">&#9670;&nbsp;</a></span>_ <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">A</td><td>)</td>
          <td>&#160;&#160;&#160;gettext(A)</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section author"><dt>Author</dt><dd>Cherniaev Egor </dd></dl>

</div>
</div>
<a id="a8db4f72cfa2b36aba553c8fd1ab6af9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8db4f72cfa2b36aba553c8fd1ab6af9e">&#9670;&nbsp;</a></span>LOCALE_DIR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOCALE_DIR&#160;&#160;&#160;&quot;locale&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For l18n - define here the directory with .mo files. </p>

</div>
</div>
<a id="aca8570fb706c81df371b7f9bc454ae03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca8570fb706c81df371b7f9bc454ae03">&#9670;&nbsp;</a></span>PACKAGE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PACKAGE&#160;&#160;&#160;&quot;core&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Define here the name of file.mo to use. </p>

</div>
</div>
<a id="a5ab5b9aaf3850b085ca39abf901b2751"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ab5b9aaf3850b085ca39abf901b2751">&#9670;&nbsp;</a></span>TEST_CASE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TEST_CASE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Define TEST_CASE to perfom output to stdout when debuging or testing. </p>
<p>Library to parse and sort csv by path CHECK BEFORE USE : timestamp_col(http:ts), path_to_csv(http:pth). FOR DATABASE : table_name(http:tbl), max_entry_size(in code) </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab3444f46f7643490834531d552454bcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3444f46f7643490834531d552454bcd">&#9670;&nbsp;</a></span>create_table_if_notexist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_table_if_notexist </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>csv_header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kore_pgsql *&#160;</td>
          <td class="paramname"><em>sql</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates table if not exist. </p>
<p>If table does not exist, we create it This is reached with SQL command csv_header, csv header to init table with sql, database to use </p>
<p>Buffer to hold query</p>
<p>We would like to check if table exists, before creating it</p>
<p>Filling table header in form_and_fire_query fasion</p>
<p>As well we are looking for timestamp column, to indicate it as timestamp</p>
<p>Setting up connection</p>
<p>Performing query </p>

</div>
</div>
<a id="a50873f71312e18a4e1eeb8b30c4b755f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50873f71312e18a4e1eeb8b30c4b755f">&#9670;&nbsp;</a></span>database_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int database_query </td>
          <td>(</td>
          <td class="paramtype">struct kore_pgsql *&#160;</td>
          <td class="paramname"><em>sql</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>table_sorted</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up database connection, performs all queries. </p>
<p>Open connection</p>
<p>Prepare memory for queries, initialised olny onece</p>
<p>Forming and firing off queries</p>
<p>As we do not include first row (it is a header) </p>

</div>
</div>
<a id="af8192996f3c522f10ab475ec2b6e6f4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8192996f3c522f10ab475ec2b6e6f4a">&#9670;&nbsp;</a></span>form_and_fire_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int form_and_fire_query </td>
          <td>(</td>
          <td class="paramtype">struct kore_buf *&#160;</td>
          <td class="paramname"><em>qr_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct kore_pgsql *&#160;</td>
          <td class="paramname"><em>sql</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>line</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Responsible for quering database with INSERT commands. </p>
<p>Each line of csv sent separetly by this function. If escape is needed - this function wraps query with escape characters As input : qr_buf, extern buffer to temp.hold query sql, to post query to line, separated line to fire off </p>
<p>Postgres uses dollar sign to escape symbols like ', " ... *_e stands for escape, and *_s for simple, with no escape</p>
<p>Holds sizes of query tags, so not to count them each time</p>
<p>Depending on settings we choose tags</p>
<p>Escape sizes differes by only two</p>
<p>Form and send query to previously initialized database Note sizes of command</p>
<p>Due to EOL we should down it by 1</p>
<p>Holeds current symbol</p>
<p>Counter for open apostrofs</p>
<p>Counter for close apostrofs</p>
<p>Appending open tags</p>
<p>Appending data</p>
<p>Appending close tag</p>
<p>Appending end tag</p>
<p>Firing off built query</p>
<p>As the buffer is always in use - clean it as soon as we are done </p>

</div>
</div>
<a id="a0939e2f18610176aada23a5961ce7ecd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0939e2f18610176aada23a5961ce7ecd">&#9670;&nbsp;</a></span>form_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int form_response </td>
          <td>(</td>
          <td class="paramtype">struct kore_buf *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>table_sorted</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forms html response, but does not send it. Table is formed from 'table_sorted'. </p>
<p>The table is created and filled with csv data. Some style can be added. First it takes header and then adds each piece od data wraped properly with table tags Then end part is added. </p>
<p>Header</p>
<p>Indicates if open tag has been added</p>
<p>Indicates if close tag has been added</p>
<p>Formating each line and append it to buffer</p>
<p>tmp holds pointer to the next sorted line</p>
<p>Create new line</p>
<p>As we have counted maximum line length, we do not need to iterate more</p>
<p>Now we are looking for two things : end of line and separators</p>
<p>Rutine for tags</p>
<p>Append data</p>
<p>= &amp;current_char</p>
<p>As we are done with tags - close HTML document </p>

</div>
</div>
<a id="a63c2c93fc1421e2956860a788fce8617"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63c2c93fc1421e2956860a788fce8617">&#9670;&nbsp;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register database. </p>
<p>Register our database</p>
<p>Setting the i18n environment. L18n is done by user's settings </p>

</div>
</div>
<a id="a6543687223c9eafbac413e52ddd2da7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6543687223c9eafbac413e52ddd2da7b">&#9670;&nbsp;</a></span>page()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int page </td>
          <td>(</td>
          <td class="paramtype">struct http_request *&#160;</td>
          <td class="paramname"><em>req</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dealing with request. </p>
<p>The path to file is passed in request with tag 'pth'. Timestamp column has tag 'ts'.</p>
<p>Validate suplied parameters</p>
<p>Holds csv, sorted by <a class="el" href="agrlib__v1_8h.html#af68635331d12bfd02f30d9b4be320cfa">agregate()</a> Sorted csv is a collection of pointers in rigth order, the header is included</p>
<p>Holds all errors we will find, to include in response Sorted succesfuly ? go for database. Note that first we perfom quering, and only then responsing</p>
<p>Database workflow done in usual fasion</p>
<p>Logic : try to create table(even if exists) &mdash;&gt; if exists : skip, else : create table with eather suplied name or name formed from file path</p>
<p>When done, we will form and send our queries with csv data</p>
<p>Holds response HTML table as text</p>
<p>Forming response</p>
<p>For test purposes</p>
<p>As we are here this means everything is ok, no errors met and we are ready to finally response with success</p>
<p>everything is ok</p>
<p>An error in forming HTML table occured. We are going to inform user about it Note, when changing error text - change it's length</p>
<p>An error in querring database occured. It can be what ever, other includes in error report will try to tell more on this</p>
<p>An error in creating table occured.</p>
<p>An error in sorting csv occured: Generaly it heppens due to mistakes in 1) creating csv 2) mistakes with timestamp length and column</p>
<p>An error in sorting csv occured: Generaly it heppens due to mistakes in 1) creating csv 2) mistakes with timestamp length and column</p>
<p>We dont get here if everything is OK </p>

</div>
</div>
<a id="a9f53c2262b7acaa2b5a1e1d2463f14f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f53c2262b7acaa2b5a1e1d2463f14f1">&#9670;&nbsp;</a></span>setup_conn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int setup_conn </td>
          <td>(</td>
          <td class="paramtype">struct kore_pgsql *&#160;</td>
          <td class="paramname"><em>sql</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up / opens connection with database. </p>
<p>Initialise data structure</p>
<p>Try again</p>
<p>All attempts failed </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1bffe9444fb0c41cb785eef0ceb29a8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bffe9444fb0c41cb785eef0ceb29a8d">&#9670;&nbsp;</a></span>conn_str</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char conn_str[] = &quot;host=localhost dbname=your_database_name user=example_user password=example&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main connection string, fill with your parametrs according to PGSQL connection string rules. </p>

</div>
</div>
<a id="a56c55320a85231784cb14d45e6d8043a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56c55320a85231784cb14d45e6d8043a">&#9670;&nbsp;</a></span>error_response_end</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char error_response_end[] = &quot;&lt;/body&gt;&lt;/html&gt;&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aba77d446d3c6b20fc708dbaa56669a8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba77d446d3c6b20fc708dbaa56669a8d">&#9670;&nbsp;</a></span>error_response_header</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char error_response_header[] = &quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=\&quot;utf-8\&quot;&gt;&lt;/head&gt;&lt;body&gt;LOG:&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tamplate for generated HTML error response. </p>

</div>
</div>
<a id="a6b9a9c1be87e8344b94882f91f56805b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b9a9c1be87e8344b94882f91f56805b">&#9670;&nbsp;</a></span>escape_needed</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int escape_needed = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This flag wraps query in $$ for escaping some characters(like quots) </p>

</div>
</div>
<a id="ad25499646dfc76b1dfafbe258ea21f19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad25499646dfc76b1dfafbe258ea21f19">&#9670;&nbsp;</a></span>form_name_from_path</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int form_name_from_path = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If no name was suplied to create table with and this flag is up - we will get name from file. </p>

</div>
</div>
<a id="a519c8e500ba2ea066c723ee28e30fa04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a519c8e500ba2ea066c723ee28e30fa04">&#9670;&nbsp;</a></span>html_table</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char html_table[] = &quot;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=\&quot;UTF-8\&quot;&gt;&lt;style&gt;table{font-family: arial, sans-serif;border-collapse: collapse;width: 100%;}td, th {border: 1px solid #dddddd;text-align: left;padding: 8px;}tr:nth-child(even) {background-color: #dddddd;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;RESULTS&lt;/h2&gt;&lt;table&gt;&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tamplate for generated HTML table. </p>

</div>
</div>
<a id="a88018c0aba001bc30dd2bf70c5098c02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88018c0aba001bc30dd2bf70c5098c02">&#9670;&nbsp;</a></span>html_table_end</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char html_table_end[] = &quot;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>End of table. </p>

</div>
</div>
<a id="ac6415df1e2eb068fae92d9ec1dab1702"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6415df1e2eb068fae92d9ec1dab1702">&#9670;&nbsp;</a></span>max_entry_size</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char max_entry_size[] = &quot; varchar(40) &quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If table is new created, each entry is treated as text(varchar). Here is max size of each entry. </p>

</div>
</div>
<a id="abc370adb7e2af08ae0ab13964d45d1c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc370adb7e2af08ae0ab13964d45d1c4">&#9670;&nbsp;</a></span>max_try_conn</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int max_try_conn = 5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Holds the number of attempts to do, when trying to access database. </p>

</div>
</div>
<a id="a299efd1f0f06729d349e9c000260a4a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a299efd1f0f06729d349e9c000260a4a1">&#9670;&nbsp;</a></span>name_len</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int name_len = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4b2ae53d82dc2d82a6ba3d6488e3638f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b2ae53d82dc2d82a6ba3d6488e3638f">&#9670;&nbsp;</a></span>path_to_csv</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* path_to_csv</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab013af67ba953d509575c86d9e65da44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab013af67ba953d509575c86d9e65da44">&#9670;&nbsp;</a></span>table_name</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* table_name</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Table name to use if it is not created from file name(CREATE_NAME_FROM_FILE not defined) </p>

</div>
</div>
<a id="a706bc0a919ca845fc1f5c8f58074e924"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a706bc0a919ca845fc1f5c8f58074e924">&#9670;&nbsp;</a></span>ts_in_db</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char ts_in_db[] = &quot; timestamp &quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This key is used for column with timestamp, if database is created. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
